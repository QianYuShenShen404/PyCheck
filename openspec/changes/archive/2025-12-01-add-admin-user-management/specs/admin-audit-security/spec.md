## ADDED Requirements
### Requirement: 管理员审计日志
The system MUST be able to
The system MUST record all administrative actions with detailed information for compliance and security auditing.
系统必须记录所有管理员操作和详细信息用于合规性和安全审计。

#### Scenario: 系统记录管理员用户创建
- **GIVEN** 管理员创建新用户
- **WHEN** 用户创建成功完成
- **THEN** 系统创建审计日志条目：
  - 操作："USER_CREATE"
  - 目标："user:<new_user_id>"
  - 管理员 ID：执行管理员
  - 时间戳：当前时间
  - 结果："SUCCESS"
  - 详情：JSON，包含新用户的用户名、显示名称、角色
- **AND** 日志立即写入 admin_audit_logs 表
- **AND** 日志创建后不能被删除或修改

#### Scenario: 系统记录管理员数据删除
- **GIVEN** 管理员删除用户或数据
- **WHEN** 删除操作完成
- **THEN** 系统记录审计条目：
  - 操作："USER_DELETE" 或 "DATA_CLEANUP" 等
  - 目标：特定资源
  - 管理员 ID：执行管理员
  - 时间戳：完成时间
  - 结果："SUCCESS" 或 "FAILED"
  - 详情：JSON，包含操作细节（计数、原因）
- **AND** 日志以仅追加方式存储

#### Scenario: 系统记录配置变更
- **GIVEN** 管理员更改系统设置
- **WHEN** 设置保存时
- **THEN** 系统记录：
  - 操作："SETTING_CHANGE"
  - 目标：设置键
  - 管理员 ID：执行管理员
  - 结果："SUCCESS"
  - 详情：JSON，包含旧值、新值、验证结果
- **AND** 设置变更立即生效

#### Scenario: 系统记录失败的管理员操作
- **GIVEN** 管理员尝试失败的操作
- **WHEN** 操作由于验证、权限或系统错误而失败
- **THEN** 系统记录失败：
  - 操作：尝试的操作
  - 目标：资源
  - 管理员 ID：尝试的管理员
  - 结果："FAILED"
  - 详情：JSON，包含错误消息、错误代码、失败原因
- **AND** 即使操作未修改数据，也记录失败

### Requirement: 审计日志查看和过滤
The system MUST be able to
管理员必须能够查看、搜索和过滤审计日志用于安全调查和合规审查。

#### Scenario: 管理员查看审计日志仪表盘
- **GIVEN** 管理员已登录
- **WHEN** 管理员导航到审计日志部分
- **THEN** 系统显示最近审计条目的分页列表
- **AND** 每个条目显示：
  - 日期和时间
  - 管理员姓名
  - 执行的操作
  - 目标（用户、作业等）
  - 结果（SUCCESS/FAILED）
  - 详情（可展开）
- **AND** 条目按时间戳排序（最新的在前）
- **AND** 系统显示总条目数

#### Scenario: 管理员按日期范围过滤审计日志
- **GIVEN** 管理员想要审查特定时期的日志
- **WHEN** 管理员选择开始和结束日期并点击过滤
- **THEN** 系统仅显示日期范围内的日志
- **AND** 过滤在审计日志屏幕上持续存在
- **AND** 管理员可以清除过滤器以查看所有日志

#### Scenario: 管理员按操作类型过滤审计日志
- **GIVEN** 管理员想要查找特定类型的操作
- **WHEN** 管理员选择操作过滤器（例如 USER_DELETE, DATA_CLEANUP）
- **THEN** 系统仅显示匹配选定操作类型的日志
- **AND** 可以同时选择多个操作
- **AND** 系统显示匹配条目的计数

#### Scenario: 管理员搜索审计日志
- **GIVEN** 管理员正在调查特定事件
- **WHEN** 管理员输入搜索词（用户名、操作等）
- **AND** 点击搜索
- **THEN** 系统搜索日志详情和目标字段
- **AND** 显示匹配的条目
- **AND** 搜索不区分大小写
- **AND** 高亮匹配文本

#### Scenario: 管理员导出审计日志
- **GIVEN** 管理员需要外部审查的审计日志
- **WHEN** 管理员点击"导出日志"并选择日期范围
- **THEN** 系统生成包含过滤日志的 CSV 或 JSON 文件
- **AND** 文件包含所有日志字段
- **AND** 文件保存到 Downloads 目录
- **AND** 系统记录导出操作本身

### Requirement: 审计日志保留
The system MUST be able to
系统必须根据可配置策略管理审计日志保留并提供清理功能。

#### Scenario: 管理员配置审计日志保留
- **GIVEN** 管理员正在设置合规策略
- **WHEN** 管理员设置审计日志保留期（默认 365 天）
- **AND** 保存设置
- **THEN** 系统将保留期存储在 admin_settings 中
- **AND** 系统将保留应用于未来的清理操作
- **AND** 清理期间删除较旧的日志

#### Scenario: 系统自动清理旧审计日志
- **GIVEN** 审计日志保留设置为 180 天
- **WHEN** 清理操作运行
- **THEN** 系统删除超过 180 天的审计日志
- **AND** 系统记录清理操作本身
- **AND** 在清理摘要中记录删除的日志计数

#### Scenario: 管理员手动清除审计日志
- **GIVEN** 管理员想要清除审计历史
- **WHEN** 管理员选择日期范围并点击"清除日志"
- **AND** 管理员确认破坏性操作
- **THEN** 系统删除所选范围内的审计日志
- **AND** 系统记录清除操作
- **AND** 系统显示确认和删除的日志计数

### Requirement: 安全监控
The system MUST be able to
系统必须监控安全相关事件并向管理员提供警报。

#### Scenario: 系统检测到多次管理员登录失败
- **GIVEN** 管理员账户受到暴力破解攻击
- **WHEN** 15 分钟内发生 5+ 次登录失败尝试
- **THEN** 系统创建安全警报：
  - 类型："SECURITY_ALERT"
  - 消息："检测到多次登录失败尝试"
  - 详情：尝试次数、时间窗口、IP/设备信息
  - 严重性："HIGH"
- **AND** 警报显示在管理员仪表盘上
- **AND** 警报记录在审计日志中

#### Scenario: 系统检测到未授权的访问尝试
- **GIVEN** 非管理员用户尝试访问管理员功能
- **WHEN** 用户尝试管理员操作或导航到管理员 URL
- **THEN** 系统记录安全事件：
  - 操作："UNAUTHORIZED_ACCESS_ATTEMPT"
  - 目标：尝试的资源
  - 用户 ID：非管理员用户
  - 结果："BLOCKED"
  - 详情：IP 地址、设备信息、时间戳
- **AND** 系统向用户显示"访问被拒绝"
- **AND** 重复尝试可能触发账户锁定

#### Scenario: 系统检测到可疑的数据删除模式
- **GIVEN** 管理员正在执行批量删除
- **WHEN** 删除操作影响 >100 条记录
- **THEN** 系统记录安全事件：
  - 操作："BULK_DELETION"
  - 目标：数据类型和计数
  - 管理员 ID：执行管理员
  - 详情：删除标准、影响的记录计数
- **AND** 如果 >500 条记录，系统将活动标记为可疑
- **AND** 标记的活动在审计日志仪表盘中突出显示

### Requirement: 强制登出功能
The system MUST be able to
管理员必须能够强制终止任何用户会话用于安全事件响应。

#### Scenario: 管理员强制用户登出
- **GIVEN** 管理员正在调查安全事件
- **WHEN** 管理员选择用户并点击"强制登出"
- **AND** 管理员确认操作
- **THEN** 系统使用户的活跃会话无效
- **AND** 用户立即登出
- **AND** 用户下次操作时看到"会话被管理员终止"消息
- **AND** 系统在审计日志中记录强制登出：
  - 操作："FORCED_LOGOUT"
  - 目标：用户 ID
  - 管理员 ID：执行管理员
  - 详情：原因（可选）

#### Scenario: 管理员强制所有用户登出
- **GIVEN** 安全事件要求所有用户登出
- **WHEN** 管理员点击"强制所有用户登出"
- **AND** 管理员确认批量登出
- **THEN** 系统使除当前管理员外的所有活跃会话无效
- **AND** 所有用户登出
- **AND** 系统记录单个"BULK_LOGOUT"事件
- **AND** 受影响用户的计数记录在审计日志中

#### Scenario: 用户尝试在强制登出后继续
- **GIVEN** 用户被强制登出
- **WHEN** 用户尝试在应用中执行操作
- **THEN** 系统显示"会话终止 - 请重新登录"
- **AND** 用户重定向到登录屏幕
- **AND** 用户必须重新认证才能继续

### Requirement: 相似度风险扫描
The system MUST be able to
系统必须自动扫描作业以发现异常的高相似模式并向管理员警报。

#### Scenario: 系统检测到具有可疑相似度分布的作业
- **GIVEN** 作业上的查重检查完成
- **WHEN** 系统分析结果并发现：
  - >50% 的提交与另一个提交的相似度 >70%，或者
  - >20 个提交对的相似度 >90%
- **THEN** 系统创建风险警报：
  - 类型："SUSPICIOUS_SIMILARITY"
  - 作业 ID：受影响的作业
  - 严重性：基于百分比的"HIGH"或"MEDIUM"
  - 详情：相似度统计、受到影响的学生对
- **AND** 警报显示在管理员仪表盘上
- **AND** 警报记录在审计日志中

#### Scenario: 管理员查看风险警报
- **GIVEN** 管理员想要审查安全警报
- **WHEN** 管理员导航到安全 → 风险警报
- **THEN** 系统显示警报列表：
  - 警报类型（SUSPICIOUS_SIMILARITY、FAILED_LOGINS 等）
  - 受影响的作业或资源
  - 严重性级别
  - 检测日期
  - 状态（NEW、REVIEWED、DISMISSED）
- **AND** 管理员可以按严重性和类型过滤
- **AND** 管理员可以将警报标记为已审查或已忽略

#### Scenario: 管理员忽略风险警报
- **GIVEN** 管理员已审查可疑相似度警报
- **WHEN** 管理员点击警报上的"忽略"
- **AND** 添加可选评论
- **THEN** 系统将警报标记为已忽略
- **AND** 忽略记录在审计日志中并带有评论
- **AND** 警报保留在历史中但从活动警报中隐藏

### Requirement: 会话管理
The system MUST be able to
系统必须跟踪和管理用户会话用于安全监控和强制登出功能。

#### Scenario: 系统跟踪活跃会话
- **GIVEN** 用户登录
- **WHEN** 认证成功时
- **THEN** 系统创建会话记录：
  - 用户 ID
  - 登录时间戳
  - 设备信息
  - 会话令牌
- **AND** 会话存储在会话表中
- **AND** 会话在登出或强制终止前有效

#### Scenario: 管理员查看活跃会话
- **GIVEN** 管理员想要监控活跃用户
- **WHEN** 管理员查看安全 → 活跃会话
- **THEN** 系统显示：
  - 已登录用户列表
  - 登录时间
  - 最后活动时间
  - 会话持续时间
- **AND** 管理员可以按用户角色过滤
- **AND** 管理员可以强制登出任何会话

#### Scenario: 系统使过期会话失效
- **GIVEN** 用户会话长时间不活跃
- **WHEN** 24 小时无活动（可配置）
- **THEN** 系统将会话标记为已过期
- **AND** 用户下次操作时必须重新认证
- **AND** 过期记录在审计日志中

### Requirement: 安全设置配置
The system MUST be able to
管理员必须能够配置安全策略和阈值。

#### Scenario: 管理员配置密码策略
- **GIVEN** 管理员正在审查安全设置
- **WHEN** 管理员设置密码要求（最小长度、复杂度）
- **AND** 保存设置
- **THEN** 系统在创建新密码时强制执行策略
- **AND** 系统可能提示现有用户更新弱密码
- **AND** 配置变更记录在审计日志中

#### Scenario: 管理员配置会话超时
- **GIVEN** 管理员想要降低安全风险
- **WHEN** 管理员将会话超时设置为 8 小时
- **AND** 保存配置
- **THEN** 所有会话在 8 小时不活动后过期
- **AND** 用户必须在超时后重新认证
- **AND** 变更记录在审计日志中

#### Scenario: 管理员配置登录失败阈值
- **GIVEN** 管理员想要防止暴力破解攻击
- **WHEN** 管理员将"最大登录失败数"设置为 5
- **AND** 将"锁定持续时间"设置为 30 分钟
- **AND** 保存设置
- **THEN** 系统在 5 次失败后锁定账户
- **AND** 锁定的账户在 30 分钟内无法登录
- **AND** 锁定事件记录在审计日志中
- **AND** 系统向管理员通知账户锁定（可选）
