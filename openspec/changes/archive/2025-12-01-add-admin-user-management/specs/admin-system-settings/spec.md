## MODIFIED Requirements
### Requirement: 相似度阈值配置
The system MUST be able to
系统必须允许管理员配置用于查重检测和警告的相似度阈值。

#### Scenario: 管理员配置相似度阈值
- **GIVEN** 管理员已登录
- **WHEN** 管理员导航到系统设置 → 相似度检测
- **AND** 管理员修改相似度阈值（默认 60%）
- **AND** 管理员保存设置
- **THEN** 系统将新阈值存储在 admin_settings 表中
- **AND** 阈值应用于所有未来的查重检查
- **AND** 阈值变更反映在报告生成中
- **AND** 系统在审计日志中记录带有旧值和新值的配置变更

#### Scenario: 管理员查看相似度阈值影响
- **GIVEN** 管理员已更改相似度阈值
- **WHEN** 管理员查看阈值设置
- **THEN** 系统显示：
  - 当前阈值值
  - 如果更改将受影响的报告数量
  - 当前阈值下的高相似度警告计数
  - 不同阈值值的警告预览

#### Scenario: 系统使用配置的阈值进行检测
- **GIVEN** 管理员已将相似度阈值设置为 75%
- **WHEN** 作业上的查重检查运行
- **THEN** 系统将相似度 >= 75% 的对标记为高风险
- **AND** 报告显示"高相似度 (>=75%)"标签
- **AND** 警告列表仅包括相似度 >= 75% 的对

#### Scenario: 管理员将阈值重置为默认值
- **GIVEN** 管理员已修改阈值
- **WHEN** 管理员点击"重置为默认值"按钮
- **THEN** 系统将阈值恢复到 60%
- **AND** 系统在审计日志中记录重置操作
- **AND** 更改立即应用于未来检查

### Requirement: 保留策略配置
The system MUST be able to
系统必须允许管理员配置报告、提交和相似度数据的数据保留期。

#### Scenario: 管理员配置报告保留期
- **GIVEN** 管理员在系统设置 → 数据保留
- **WHEN** 管理员更改报告保留天数（默认 30）
- **AND** 管理员保存配置
- **THEN** 系统用新的保留期更新 admin_settings
- **AND** 清理操作使用新的保留期
- **AND** 系统显示将删除的数据预览
- **AND** 系统在审计日志中记录配置变更

#### Scenario: 管理员配置提交保留期
- **GIVEN** 管理员正在配置数据保留
- **WHEN** 管理员修改提交保留天数（默认 180）
- **AND** 管理员保存设置
- **THEN** 系统存储新的保留期
- **AND** 基于新策略删除旧提交
- **AND** 系统记录配置变更

#### Scenario: 系统强制执行保留策略
- **GIVEN** 管理员已将报告保留设置为 45 天
- **WHEN** 清理操作运行
- **THEN** 系统删除超过 45 天的报告
- **AND** 系统保留最近 45 天的报告
- **AND** 删除在审计日志中记录日期阈值

### Requirement: 快速比较模式
The system MUST be able to
系统必须允许管理员切换"快速比较"模式，该模式以准确性为代价优化算法性能。

#### Scenario: 管理员启用快速比较模式
- **GIVEN** 管理员在系统设置 → 算法设置
- **WHEN** 管理员将"快速比较模式"切换为开启
- **AND** 管理员保存设置
- **THEN** 系统在算法中禁用标识符规范化
- **AND** 查重检测运行更快（估计 30-50% 速度提升）
- **AND** 检测可能不准确（更多假阳性/假阴性）
- **AND** 系统显示有关准确性影响的警告
- **AND** 系统在审计日志中记录设置变更

#### Scenario: 管理员禁用快速比较模式
- **GIVEN** 快速比较模式已启用
- **WHEN** 管理员将其关闭
- **AND** 管理员保存设置
- **THEN** 系统启用带有标识符规范化的完整算法
- **AND** 检测准确性提高
- **AND** 处理时间可能增加
- **AND** 系统记录设置变更

#### Scenario: 系统将快速模式应用于新检查
- **GIVEN** 管理员已启用快速比较模式
- **WHEN** 老师在作业上开始查重检查
- **THEN** 系统使用快速算法（无标识符规范化）
- **AND** 处理完成得更快
- **AND** 结果标记有"快速模式"指示器
- **AND** 管理员可以看到哪些报告使用了快速模式

### Requirement: 日志级别配置
The system MUST be able to
系统必须允许管理员配置应用程序日志级别用于调试和监控。

#### Scenario: 管理员设置日志级别
- **GIVEN** 管理员在系统设置 → 日志
- **WHEN** 管理员选择日志级别（DEBUG/INFO/WARN/ERROR）
- **AND** 管理员保存配置
- **THEN** 系统在 admin_settings 中更新日志级别
- **AND** 应用程序立即开始在新级别记录日志
- **AND** 仅当日志级别为 DEBUG 时才显示 DEBUG 日志
- **AND** 系统在审计日志中记录配置变更
- **AND** 更改在应用重启后持续

#### Scenario: 管理员查看日志设置
- **GIVEN** 管理员正在审查日志配置
- **WHEN** 管理员查看当前日志级别
- **THEN** 系统显示：
  - 当前日志级别
  - 日志文件大小和位置
  - 每个级别的日志条目数（DEBUG/INFO/WARN/ERROR）
  - 上次日志轮换日期
  - 导出日志用于调试的选项

#### Scenario: 系统按配置的级别过滤日志
- **GIVEN** 管理员已将日志级别设置为 WARN
- **WHEN** 应用程序生成日志
- **THEN** 系统仅将 WARN 和 ERROR 级别的消息记录到文件
- **AND** 丢弃 DEBUG 和 INFO 消息
- **AND** 日志文件大小减少
- **AND** 使用不太详细的日志，故障排除可能更难

### Requirement: 系统参数配置
The system MUST be able to
系统必须允许配置各种系统参数，包括每作业的最大提交数、默认设置和功能开关。

#### Scenario: 管理员配置每作业的最大提交数
- **GIVEN** 管理员正在设置系统参数
- **WHEN** 管理员修改"每作业最大提交数"（默认 200）
- **AND** 管理员保存设置
- **THEN** 系统在学生提交代码时强制执行新限制
- **AND** 老师看到提交数与限制的对比
- **AND** 系统阻止超过限制的提交
- **AND** 系统记录配置变更

#### Scenario: 管理员配置 Python 版本默认值
- **GIVEN** 管理员在算法设置
- **WHEN** 管理员为新作业设置默认 Python 版本（2.x/3.x/两者）
- **AND** 管理员保存设置
- **THEN** 新作业默认为配置的版本
- **AND** 老师可以在创建作业时覆盖默认值
- **AND** 系统记录配置变更

#### Scenario: 管理员通过开关启用/禁用功能
- **GIVEN** 管理员正在审查功能标志
- **WHEN** 管理员切换功能（例如"允许延迟提交"、"要求代码注释"）
- **AND** 管理员保存设置
- **THEN** 切换的功能立即启用/禁用
- **AND** UI 基于开关显示/隐藏功能
- **AND** 系统在审计日志中记录每个开关变更

#### Scenario: 管理员配置 UI 主题默认值
- **GIVEN** 管理员希望标准化应用外观
- **WHEN** 管理员设置默认主题模式（浅色/深色/系统）
- **AND** 管理员保存设置
- **THEN** 新用户默认获得配置的主题
- **AND** 现有用户保持其当前主题设置
- **AND** 系统记录配置变更

### Requirement: 设置导出和导入
The system MUST be able to
系统必须允许管理员导出和导入系统设置用于备份或转移到另一个部署。

#### Scenario: 管理员导出系统设置
- **GIVEN** 管理员想要备份配置
- **WHEN** 管理员在系统设置屏幕上点击"导出设置"
- **THEN** 系统创建包含所有 admin_settings 的 JSON 文件
- **AND** 文件包含时间戳和导出的管理员用户
- **AND** 导出中排除敏感数据（密码哈希）
- **AND** 系统将文件保存到 Downloads 目录
- **AND** 系统在审计日志中记录导出

#### Scenario: 管理员导入系统设置
- **GIVEN** 管理员有设置导出文件
- **WHEN** 管理员选择导出文件并点击"导入设置"
- **AND** 系统验证 JSON 格式和设置结构
- **THEN** 系统将导入的设置应用到当前部署
- **AND** 系统在导入期间显示进度
- **AND** 系统在审计日志中记录导入和导入管理员名称
- **AND** 在导入前备份旧设置

#### Scenario: 管理员导入时验证设置
- **GIVEN** 管理员尝试导入无效的设置文件
- **WHEN** 系统验证导入文件
- **THEN** 系统在以下情况下拒绝导入：
  - JSON 格式无效
  - 缺少必需设置
  - 值超出可接受范围
  - 文件来自不兼容版本
- **AND** 系统显示具体的错误消息
- **AND** 不更改任何设置
- **AND** 无效导入在审计日志中记录

## ADDED Requirements
### Requirement: 设置审计跟踪
The system MUST be able to
系统必须跟踪所有配置变更，包括谁进行了变更以及何时进行。

#### Scenario: 管理员查看设置变更历史
- **GIVEN** 管理员想要审查配置变更
- **WHEN** 管理员导航到系统设置 → 变更历史
- **THEN** 系统显示所有设置变更的按时间顺序排列的列表
- **AND** 每个条目显示：
  - 设置名称
  - 旧值和新值
  - 做出变更的管理员
  - 时间戳
  - 原因/评论（可选）
- **AND** 管理员可以按设置名称或日期范围过滤
- **AND** 历史为只读（不允许删除）

#### Scenario: 系统记录所有设置变更
- **GIVEN** 管理员修改任何系统设置
- **WHEN** 变更保存时
- **THEN** 系统记录到 admin_audit_log 表：
  - 操作："SETTING_CHANGE"
  - 目标：设置键名
  - 旧值和新值
  - 管理员用户 ID
  - 时间戳
- **AND** 日志条目包含 JSON 格式的详细变更信息

### Requirement: 设置重置为默认值
The system MUST be able to
系统必须允许管理员将所有或选定的设置重置为工厂默认值。

#### Scenario: 管理员重置所有设置
- **GIVEN** 管理员想要恢复默认配置
- **WHEN** 管理员点击"将所有设置重置为默认值"
- **AND** 管理员确认重置操作
- **THEN** 系统将所有 admin_settings 恢复为初始值
- **AND** 系统在重置前创建当前设置的备份
- **AND** 系统在审计日志中记录重置操作
- **AND** 更改立即生效

#### Scenario: 管理员重置特定设置
- **GIVEN** 管理员想要重置一个设置
- **WHEN** 管理员点击特定设置旁边的"重置"按钮
- **THEN** 系统将该设置恢复为默认值
- **AND** 其他设置保持不变
- **AND** 系统在审计日志中记录重置
- **AND** 系统显示确认消息

### Requirement: 设置验证
The system MUST be able to
系统必须验证设置值以防止无效配置。

#### Scenario: 管理员输入无效阈值
- **GIVEN** 管理员正在设置相似度阈值
- **WHEN** 管理员输入超出有效范围的值（例如 150%）
- **AND** 管理员尝试保存
- **THEN** 系统显示错误消息"值必须在 0 到 100 之间"
- **AND** 保存操作被阻止
- **AND** 设置未更改

#### Scenario: 管理员输入无效保留期
- **GIVEN** 管理员正在配置保留
- **WHEN** 管理员输入负数或极大值
- **AND** 管理员尝试保存
- **THEN** 系统验证范围（1-365 天）
- **AND** 系统显示验证错误
- **AND** 拒绝无效值

#### Scenario: 系统验证相互依赖的设置
- **GIVEN** 管理员尝试将提交保留设置为小于报告保留
- **WHEN** 管理员保存设置
- **THEN** 系统警告"提交保留应 >= 报告保留"
- **AND** 管理员可以带警告继续或取消
- **AND** 验证结果记录在审计日志中
