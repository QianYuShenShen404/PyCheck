## MODIFIED Requirements
### Requirement: 用户注册
The system MUST be able to
系统必须支持用户注册，包含用户名、密码、显示名称和角色选择（学生/教师/管理员）。

#### Scenario: 管理员创建用户账户
- **GIVEN** 管理员用户已登录
- **WHEN** 管理员输入用户名、密码、显示名称并选择角色
- **THEN** 系统创建用户账户，使用 SHA-256 对密码进行哈希并设置角色
- **AND** 系统在审计日志中记录管理员操作
- **AND** 系统向管理员显示成功消息

#### Scenario: 管理员注册第一个管理员用户
- **GIVEN** 系统中不存在管理员用户
- **WHEN** 第一个用户以管理员角色注册
- **THEN** 系统成功创建管理员用户
- **AND** 系统将用户设置为活跃和已验证
- **AND** 系统允许访问管理员功能

### Requirement: 用户管理
The system MUST be able to
管理员用户必须能够管理系统中的所有用户，包括创建、查看、更新、禁用、删除和角色变更。

#### Scenario: 管理员查看所有用户
- **GIVEN** 管理员用户已登录
- **WHEN** 管理员导航到用户管理屏幕
- **THEN** 系统显示所有用户的分页列表
- **AND** 每个用户显示用户名、显示名称、角色、状态和创建日期
- **AND** 系统显示用户总数

#### Scenario: 管理员创建新用户
- **GIVEN** 管理员在用户管理屏幕上
- **WHEN** 管理员点击"创建用户"并填写必填字段表单
- **THEN** 系统验证输入并创建用户账户
- **AND** 系统使用 SHA-256 对密码进行哈希
- **AND** 系统将默认状态设置为 ACTIVE
- **AND** 系统在审计日志中记录操作

#### Scenario: 管理员编辑用户信息
- **GIVEN** 管理员正在查看用户详情
- **WHEN** 管理员修改显示名称或其他信息并保存
- **THEN** 系统更新数据库中的用户信息
- **AND** 系统在审计日志中记录修改
- **AND** 系统显示成功确认

#### Scenario: 管理员更改用户角色
- **GIVEN** 管理员在用户管理视图中
- **WHEN** 管理员选择用户并更改角色（学生 ↔ 教师 ↔ 管理员）
- **THEN** 系统立即更新用户角色
- **AND** 系统在审计日志中记录角色变更，包含旧角色和新角色
- **AND** 系统显示成功消息
- **AND** 如果用户的角色从管理员变更，系统在下一次操作时撤销管理员访问权限

#### Scenario: 管理员禁用用户
- **GIVEN** 管理员在用户列表视图中
- **WHEN** 管理员选择用户并点击"禁用"
- **AND** 管理员确认操作
- **THEN** 系统将用户状态设置为 DISABLED
- **AND** 系统在审计日志中记录操作
- **AND** 被禁用的用户无法登录（系统拒绝登录尝试）
- **AND** 被禁用用户的提交仍可见但标记为非活跃

#### Scenario: 管理员启用已禁用用户
- **GIVEN** 管理员在查看已禁用用户
- **WHEN** 管理员点击"启用"并确认
- **THEN** 系统将用户状态设置为 ACTIVE
- **AND** 系统在审计日志中记录操作
- **AND** 用户可以再次登录

#### Scenario: 管理员删除用户（软删除）
- **GIVEN** 管理员在用户管理视图中
- **WHEN** 管理员选择用户并点击"删除"
- **AND** 管理员通过输入确认来确认破坏性操作
- **THEN** 系统将用户的 is_active 标志设置为 false
- **AND** 系统保留用户记录以供审计
- **AND** 系统在审计日志中记录操作和删除时间戳
- **AND** 被删除的用户无法登录
- **AND** 用户的历史数据（提交、报告）保留在数据库中但标记为已删除

#### Scenario: 管理员查看用户提交历史
- **GIVEN** 管理员在查看用户详情
- **WHEN** 管理员点击用户查看详细信息
- **THEN** 系统显示用户的提交历史
- **AND** 显示所有提交的作业、文件名和时间戳
- **AND** 显示用户提交查重检查结果
- **AND** 数据对管理员为只读（无修改权限）

### Requirement: 批量用户操作
The system MUST be able to
管理员用户必须能够对用户执行批量操作，包括 CSV/JSON 导入和导出。

#### Scenario: 管理员将用户列表导出为 CSV
- **GIVEN** 管理员在用户管理屏幕上
- **WHEN** 管理员点击"导出用户"并选择 CSV 格式
- **THEN** 系统生成包含所有用户数据的 CSV 文件（用户名、显示名称、角色、状态、创建日期）
- **AND** 系统将文件保存到 Downloads 目录
- **AND** 系统在导出期间显示进度指示器
- **AND** 系统在审计日志中记录导出操作

#### Scenario: 管理员将用户列表导出为 JSON
- **GIVEN** 管理员在用户管理屏幕上
- **WHEN** 管理员点击"导出用户"并选择 JSON 格式
- **THEN** 系统生成包含结构化用户数据的 JSON 文件
- **AND** 系统保留所有用户字段，包括密码哈希（可选）
- **AND** 系统在审计日志中记录导出操作

#### Scenario: 管理员从 CSV 导入用户
- **GIVEN** 管理员在批量导入屏幕上
- **WHEN** 管理员选择 CSV 文件并点击"导入"
- **THEN** 系统解析 CSV 并验证数据格式
- **AND** 系统为每个有效行创建用户
- **AND** 系统跳过重复的用户名并记录错误
- **AND** 系统显示导入进度和结果摘要
- **AND** 系统在审计日志中记录导入操作

#### Scenario: 管理员从 JSON 导入用户
- **GIVEN** 管理员在批量导入屏幕上
- **WHEN** 管理员选择 JSON 文件并点击"导入"
- **THEN** 系统验证 JSON 结构
- **AND** 系统基于数据创建或更新用户
- **AND** 系统支持创建新和更新现有两种模式
- **AND** 系统在审计日志中记录导入操作

#### Scenario: 管理员重置用户密码
- **GIVEN** 管理员在用户管理视图中
- **WHEN** 管理员选择用户并点击"重置密码"
- **AND** 管理员输入新的临时密码
- **THEN** 系统使用 SHA-256 对新密码进行哈希
- **AND** 系统更新用户的密码哈希
- **AND** 系统在审计日志中记录操作
- **AND** 用户必须在下次登录时更改密码（可选标志）

### Requirement: 用户状态管理
The system MUST be able to
系统必须跟踪用户状态（ACTIVE/DISABLED）并基于状态强制执行访问控制。

#### Scenario: 已禁用用户尝试登录
- **GIVEN** 用户账户被管理员禁用
- **WHEN** 已禁用用户尝试使用正确凭据登录
- **THEN** 系统拒绝登录并显示错误消息"账户已禁用"
- **AND** 系统在审计日志中记录失败的登录尝试
- **AND** 用户无法访问任何应用程序功能

#### Scenario: 管理员查看用户统计
- **GIVEN** 管理员在仪表盘上
- **WHEN** 管理员查看用户统计部分
- **THEN** 系统显示总用户数、活跃用户数、被禁用用户数
- **AND** 按角色显示细分（学生/教师/管理员）
- **AND** 显示最近的用户活动（过去 30 天内的注册）

### Requirement: 权限强制执行
The system MUST be able to
系统必须强制执行基于角色的访问控制，确保只有管理员用户可以访问管理员功能。

#### Scenario: 学生尝试访问管理员功能
- **GIVEN** 学生用户已登录
- **WHEN** 学生导航到管理员部分或管理员 URL
- **THEN** 系统显示"访问被拒绝"消息
- **AND** 系统不显示管理员 UI 组件
- **AND** 系统在审计日志中记录未授权的访问尝试

#### Scenario: 教师尝试访问管理员功能
- **GIVEN** 教师用户已登录
- **WHEN** 教师尝试访问管理员用户管理
- **THEN** 系统显示"访问被拒绝"消息
- **AND** 教师无法执行管理员操作
- **AND** 系统在审计日志中记录未授权的访问尝试

## ADDED Requirements
### Requirement: 管理员导航
The system MUST be able to
系统必须为管理员用户提供专用导航入口以访问管理功能。

#### Scenario: 管理员用户看到管理员导航
- **GIVEN** 具有管理员角色的用户已登录
- **WHEN** 用户打开导航抽屉
- **THEN** 系统显示"管理员面板"菜单项
- **AND** 点击它导航到管理员仪表盘
- **AND** 导航显示管理员特定菜单项（用户管理、数据管理、系统设置、审计日志）

#### Scenario: 管理员仪表盘显示概览
- **GIVEN** 管理员导航到管理员仪表盘
- **WHEN** 仪表盘加载
- **THEN** 系统显示摘要卡片：总用户数、活跃作业、最近报告、系统健康
- **AND** 显示常见管理员任务的快速操作按钮
- **AND** 显示最近的审计日志条目

### Requirement: 注册时角色分配
The system MUST be able to
系统必须允许在注册期间选择角色，包括管理员角色用于初始管理员设置。

#### Scenario: 用户选择角色注册
- **GIVEN** 用户在注册屏幕上
- **WHEN** 用户填写注册表单并从下拉列表中选择角色（学生/教师/管理员）
- **THEN** 系统验证角色选择
- **AND** 系统使用选定角色创建用户
- **AND** 如果是管理员，用户可以立即访问管理员功能
- **AND** 系统在审计日志中记录注册（如果由现有管理员执行）

## RENAMED Requirements
### FROM: 需求：用户注册
### TO: 需求：用户注册和角色管理
用户注册和角色管理系统为教育机构提供全面的用户生命周期管理。

**理由**：扩展范围以包括管理员角色管理、用户状态控制和批量操作。

**迁移**：现有的用户注册功能保持不变，数据库迁移中添加新的管理员角色和状态字段。
